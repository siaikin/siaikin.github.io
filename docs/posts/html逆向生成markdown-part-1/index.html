<!doctype html><html><head lang=zh-cn><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>HTML逆向生成Markdown -- Part 1 - siaikin's Blog</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="HTML逆向生成Markdown &ndash; Part 1 之前想做一个能够提取网页中文章并转换为Markdown格式的Chrome插件，所以才有了这个项目。 结果"><meta property="og:image" content><meta property="og:title" content="HTML逆向生成Markdown -- Part 1"><meta property="og:description" content="HTML逆向生成Markdown &ndash; Part 1 之前想做一个能够提取网页中文章并转换为Markdown格式的Chrome插件，所以才有了这个项目。 结果"><meta property="og:type" content="article"><meta property="og:url" content="https://siaikin.github.io/posts/html%E9%80%86%E5%90%91%E7%94%9F%E6%88%90markdown-part-1/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-06-02T21:38:25+00:00"><meta property="article:modified_time" content="2019-06-02T21:38:25+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="HTML逆向生成Markdown -- Part 1"><meta name=twitter:description content="HTML逆向生成Markdown &ndash; Part 1 之前想做一个能够提取网页中文章并转换为Markdown格式的Chrome插件，所以才有了这个项目。 结果"><script src=https://siaikin.github.io/js/feather.min.js></script>
<link href=https://siaikin.github.io/css/fonts.11a1877508139eac0b5b4852ceb110c35641b3533321e66e39149e901ed5756b.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://siaikin.github.io/css/main.d902908ac6e0fab67957de5db5aea1b6455b19ae2ca98eac4c95a4a0fdc02238.css><link id=darkModeStyle rel=stylesheet type=text/css href=https://siaikin.github.io/css/dark.c95c5dcf5f32f8b67bd36f7dab66680e068fce2b303087294114aabf7a7c080b.css disabled></head><body><div class=content><header><div class=main><a href=https://siaikin.github.io/>siaikin's Blog</a></div><nav><a href=/>Home</a>
<a href=/posts>All posts</a>
<a href=/about>About</a>
<a href=/tags>Tags</a>
| <span id=dark-mode-toggle onclick=toggleTheme()></span>
<script src=https://siaikin.github.io/js/themetoggle.js></script></nav></header><main><article><div class=title><h1 class=title>HTML逆向生成Markdown -- Part 1</h1><div class=meta>Posted on Jun 2, 2019</div></div><section class=body><h1 id=html逆向生成markdown----part-1>HTML逆向生成Markdown &ndash; Part 1</h1><p>之前想做一个能够提取网页中文章并转换为Markdown格式的Chrome插件，所以才有了这个项目。
结果我低估了解析的难度，花了十几天才做出来一个半成品。遂放弃，记录下实现的思路，等以后水平提升了再来完善。</p><p>解析过程分为四个阶段。以下是各个阶段的简要说明。</p><ol><li>分词：将HTML原始文本分割为HTML标签</li><li>生成虚拟DOM节点：将分割后的HTML标签转换成对应的节点</li><li>构建虚拟DOM树：将节点根据其顺序生成相应的DOM树</li><li>生成Markdown文本：根据预先定义HTML To Markdown的转换规则，对DOM树进行转换。我参考的<a href=https://www.markdownguide.org/>转换规则</a></li></ol><pre tabindex=0><code class=language-flowchart data-lang=flowchart>st=&gt;start: 源HTML文本
lexer=&gt;operation: 分词
parser=&gt;operation: 生成虚拟DOM节点
filter=&gt;inputoutput: 过滤无效节点
vdomt=&gt;operation: 构建虚拟DOM树
filterAgain=&gt;inputoutput: 根据转换规则再次过滤节点
md=&gt;operation: 生成Markdown文本
ed=&gt;end: 输出Markdown文本

st(right)-&gt;lexer-&gt;parser-&gt;filter-&gt;vdomt-&gt;filterAgain-&gt;md(right)-&gt;ed
</code></pre><p><strong>下面这段HTML文本将作为解析的样例文本：</strong></p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">1</span><span><span style=color:#abb2bf>&lt;</span><span style=color:#76a9f9>h2</span> <span style=color:#cebc3a>id</span><span style=color:#54b1c7>=</span><span style=color:#98c379>&#34;逆向解析HTMl&#34;</span><span style=color:#abb2bf>&gt;</span>逆向解析HTMl<span style=color:#abb2bf>&lt;/</span><span style=color:#76a9f9>h2</span><span style=color:#abb2bf>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">2</span><span><span style=color:#abb2bf>&lt;</span><span style=color:#76a9f9>p</span><span style=color:#abb2bf>&gt;&lt;</span><span style=color:#76a9f9>a</span> <span style=color:#cebc3a>href</span><span style=color:#54b1c7>=</span><span style=color:#98c379>&#34;https://www.baidu.com&#34;</span> <span style=color:#cebc3a>rel</span><span style=color:#54b1c7>=</span><span style=color:#98c379>&#34;nofollow&#34;</span> <span style=color:#cebc3a>target</span><span style=color:#54b1c7>=</span><span style=color:#98c379>&#34;_blank&#34;</span><span style=color:#abb2bf>&gt;</span>Markdown<span style=color:#abb2bf>&lt;/</span><span style=color:#76a9f9>a</span><span style=color:#abb2bf>&gt;</span>解析过程分为四个阶段<span style=color:#abb2bf>&lt;/</span><span style=color:#76a9f9>p</span><span style=color:#abb2bf>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">3</span><span><span style=color:#abb2bf>&lt;</span><span style=color:#76a9f9>ul</span><span style=color:#abb2bf>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">4</span><span><span style=color:#abb2bf>&lt;</span><span style=color:#76a9f9>li</span><span style=color:#abb2bf>&gt;</span>分词<span style=color:#abb2bf>&lt;/</span><span style=color:#76a9f9>li</span><span style=color:#abb2bf>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">5</span><span><span style=color:#abb2bf>&lt;</span><span style=color:#76a9f9>li</span><span style=color:#abb2bf>&gt;</span>生成虚拟DOM节点<span style=color:#abb2bf>&lt;/</span><span style=color:#76a9f9>li</span><span style=color:#abb2bf>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">6</span><span><span style=color:#abb2bf>&lt;</span><span style=color:#76a9f9>li</span><span style=color:#abb2bf>&gt;</span>构建虚拟DOM树<span style=color:#abb2bf>&lt;/</span><span style=color:#76a9f9>li</span><span style=color:#abb2bf>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">7</span><span><span style=color:#abb2bf>&lt;</span><span style=color:#76a9f9>li</span><span style=color:#abb2bf>&gt;&lt;</span><span style=color:#76a9f9>p</span><span style=color:#abb2bf>&gt;</span>生成Markdown文本<span style=color:#abb2bf>&lt;/</span><span style=color:#76a9f9>p</span><span style=color:#abb2bf>&gt;&lt;/</span><span style=color:#76a9f9>li</span><span style=color:#abb2bf>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">8</span><span><span style=color:#abb2bf>&lt;/</span><span style=color:#76a9f9>ul</span><span style=color:#abb2bf>&gt;</span>
</span></span></code></pre></div><h2 id=分词>分词</h2><p>我们将源HTML文本按照<a href=https://developer.mozilla.org/zh-CN/docs/Glossary/HTML>HTML元素的语法</a>，分解为<code>Opening tag</code> <code>Closing tag</code> <code>Enclosed text content</code>。
<img src=https://mdn.mozillademos.org/files/7659/anatomy-of-an-html-element.png alt></p><p>因为HTML元素内部很可能还有嵌套的元素，所以还要继续分割<code>Enclosed text content</code>直到只剩下<code>文字文本</code>。</p><p>从上图来看很明显，<code>Opening tag</code>和<code>Closing tag</code>都是由<code>&lt;</code> <code>></code>这两个符号包裹的，那我们只需要对愿HTML文本进行一次搜索，将被<code>&lt;</code> <code>></code>包裹起来的字符串提取出来，放入一个数组中。搜索结束后数组就是我们分词的结果。
原始文本经过分割后，如下所示：</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1</span><span><span style=color:#76a9f9>const</span> <span style=color:#aa89ea>result</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>[</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2</span><span>  <span style=color:#98c379>&#39;&lt;h2 id=&#34;逆向解析HTMl&#34;&gt;&#39;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3</span><span>  <span style=color:#98c379>&#39;逆向解析HTMl&#39;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4</span><span>  <span style=color:#98c379>&#39;&lt;/h2&gt;&#39;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5</span><span>  <span style=color:#98c379>&#39;&lt;p&gt;&#39;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6</span><span>  <span style=color:#98c379>&#39;&lt;a href=&#34;https://www.baidu.com&#34; rel=&#34;nofollow&#34; target=&#34;_blank&#34;&gt;&#39;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7</span><span>  <span style=color:#98c379>&#39;Markdown&#39;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8</span><span>  <span style=color:#98c379>&#39;&lt;/a&gt;&#39;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9</span><span>  <span style=color:#98c379>&#39;解析过程分为四个阶段&#39;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10</span><span>  <span style=color:#98c379>&#39;&lt;/p&gt;&#39;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11</span><span>  <span style=color:#98c379>&#39;&lt;ul&gt;&#39;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12</span><span>  <span style=color:#98c379>&#39;&lt;li&gt;&#39;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">13</span><span>  <span style=color:#98c379>&#39;分词&#39;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">14</span><span>  <span style=color:#98c379>&#39;&lt;/li&gt;&#39;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">15</span><span>  <span style=color:#98c379>&#39;&lt;li&gt;&#39;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">16</span><span>  <span style=color:#98c379>&#39;生成虚拟DOM节点&#39;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">17</span><span>  <span style=color:#98c379>&#39;&lt;/li&gt;&#39;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">18</span><span>  <span style=color:#98c379>&#39;&lt;li&gt;&#39;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">19</span><span>  <span style=color:#98c379>&#39;构建虚拟DOM树&#39;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">20</span><span>  <span style=color:#98c379>&#39;&lt;/li&gt;&#39;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">21</span><span>  <span style=color:#98c379>&#39;&lt;li&gt;&#39;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">22</span><span>  <span style=color:#98c379>&#39;&lt;p&gt;&#39;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">23</span><span>  <span style=color:#98c379>&#39;生成Markdown文本&#39;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">24</span><span>  <span style=color:#98c379>&#39;&lt;/p&gt;&#39;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">25</span><span>  <span style=color:#98c379>&#39;&lt;/li&gt;&#39;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">26</span><span>  <span style=color:#98c379>&#39;&lt;/ul&gt;&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">27</span><span><span style=color:#abb2bf>]</span>
</span></span></code></pre></div><p><strong>需要注意的是，html标签中的属性值是允许出现<code>&lt;</code>和<code>></code>这两个符号的</strong>，也就是说会出现类似<code>&lt;div data-demo="&lt;demo>asd&lt;/demo>"></code>这样的文本。
这里要注意的是不能直接从头到尾搜索<code>&lt;</code> <code>></code>然后提取里面的字符串，不然会出现提取到<code>&lt;div data-demo="&lt;demo></code>这样的结果。</p><h5 id=我实现的方法比较简单是利用栈来判断html标签的开始和结束>我实现的方法比较简单，是利用栈来判断HTML标签的开始和结束。</h5><ol><li>首先从下标0开始，遍历字符串
2.<ol><li>如果当前的字符是<code>&lt;</code>，则将其压入栈中。</li><li>如果当前的字符是<code>></code>，且栈顶是<code>&lt;</code>，则表示一个HTML标签的结束。
然后将开始符号<code>&lt;</code>和结束符号<code>></code>之间的字符串提取出来保存到结果数组就好了。</li><li>如果当前的字符是<code>"</code>，且栈顶不是<code>"</code>，则将其压入栈中。</li><li>如果当前的字符是<code>"</code>，且栈顶是<code>"</code>，则将栈顶元素弹出。</li></ol></li></ol><p>具体实现见<a href=../src/lib/lexer.js>lexer.js</a></p><h2 id=生成虚拟dom节点>生成虚拟DOM节点</h2><p>在这一阶段，主要要对节点的属性的过滤，HTML标签内部的大部分属性都是不需要的。除了<code>a</code> <code>img</code>等几个HTML元素。
得到分词后的结果之后，就可以解析HTML标签字符串生成一个个包含HTML标签信息的对象。
对象类型如下：</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">1</span><span><span style=color:#76a9f9>const</span> <span style=color:#aa89ea>obj</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">2</span><span>    <span style=color:#8a93a5;font-style:italic>// 固定属性
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">3</span><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#aa89ea>tag</span><span style=color:#abb2bf>,</span>            <span style=color:#8a93a5;font-style:italic>// HTML标签名。如`div`, `span`
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">4</span><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#aa89ea>type</span><span style=color:#abb2bf>,</span>           <span style=color:#8a93a5;font-style:italic>// 自定义的HTML标签名所对应的数字。
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">5</span><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#aa89ea>position</span><span style=color:#abb2bf>,</span>       <span style=color:#8a93a5;font-style:italic>// 标签所在的位置。开始标签（Opening tag）：1，结束标签（Closing tag）：2，空元素（empty tag）和文本节点（text node）：3
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">6</span><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#8a93a5;font-style:italic>// 可选属性
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">7</span><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#aa89ea>attr</span><span style=color:#abb2bf>,</span>           <span style=color:#8a93a5;font-style:italic>// 标签内属性的键值对，这是一个对象。一些需要保留属性的元素如`a`元素需要保留`href` `title`用来生成Markdown文本。
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">8</span><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#aa89ea>content</span>         <span style=color:#8a93a5;font-style:italic>// 文本节点特有，用来保存文本
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">9</span><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#abb2bf>}</span>
</span></span></code></pre></div><p>这一过程得到的结果如下（有点多，这里只截取前6个比较有代表性的）：</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1</span><span><span style=color:#76a9f9>const</span> <span style=color:#aa89ea>result</span> <span style=color:#54b1c7>=</span> <span style=color:#abb2bf>[</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2</span><span>    <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3</span><span>        <span style=color:#aa89ea>tag</span><span style=color:#54b1c7>:</span> <span style=color:#98c379>&#39;h2&#39;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4</span><span>        <span style=color:#aa89ea>type</span><span style=color:#54b1c7>:</span> <span style=color:#d19a66>42</span><span style=color:#abb2bf>,</span>           <span style=color:#8a93a5;font-style:italic>// 不要在意`type`属性，这是自定义的，42代表`h2`元素对应数字
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5</span><span><span style=color:#8a93a5;font-style:italic></span>        <span style=color:#aa89ea>position</span><span style=color:#54b1c7>:</span> <span style=color:#d19a66>1</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6</span><span>    <span style=color:#abb2bf>},</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7</span><span>    <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8</span><span>        <span style=color:#aa89ea>tag</span><span style=color:#54b1c7>:</span> <span style=color:#98c379>&#39;textNode&#39;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9</span><span>        <span style=color:#aa89ea>type</span><span style=color:#54b1c7>:</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10</span><span>        <span style=color:#aa89ea>position</span><span style=color:#54b1c7>:</span> <span style=color:#d19a66>3</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11</span><span>        <span style=color:#aa89ea>content</span><span style=color:#54b1c7>:</span> <span style=color:#98c379>&#39;逆向解析HTMl&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12</span><span>    <span style=color:#abb2bf>},</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">13</span><span>    <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">14</span><span>        <span style=color:#aa89ea>tag</span><span style=color:#54b1c7>:</span> <span style=color:#98c379>&#39;h2&#39;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">15</span><span>        <span style=color:#aa89ea>type</span><span style=color:#54b1c7>:</span> <span style=color:#d19a66>42</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">16</span><span>        <span style=color:#aa89ea>position</span><span style=color:#54b1c7>:</span> <span style=color:#d19a66>2</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">17</span><span>    <span style=color:#abb2bf>},</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">18</span><span>    <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">19</span><span>        <span style=color:#aa89ea>tag</span><span style=color:#54b1c7>:</span> <span style=color:#98c379>&#39;p&#39;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">20</span><span>        <span style=color:#aa89ea>type</span><span style=color:#54b1c7>:</span> <span style=color:#d19a66>6</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">21</span><span>        <span style=color:#aa89ea>position</span><span style=color:#54b1c7>:</span> <span style=color:#d19a66>1</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">22</span><span>    <span style=color:#abb2bf>},</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">23</span><span>    <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">24</span><span>        <span style=color:#aa89ea>tag</span><span style=color:#54b1c7>:</span> <span style=color:#98c379>&#39;a&#39;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">25</span><span>        <span style=color:#aa89ea>type</span><span style=color:#54b1c7>:</span> <span style=color:#d19a66>2</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">26</span><span>        <span style=color:#aa89ea>position</span><span style=color:#54b1c7>:</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">27</span><span>        <span style=color:#aa89ea>attr</span><span style=color:#54b1c7>:</span> <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">28</span><span>            <span style=color:#aa89ea>href</span><span style=color:#54b1c7>:</span> <span style=color:#98c379>&#39;https://www.baidu.com&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">29</span><span>        <span style=color:#abb2bf>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">30</span><span>    <span style=color:#abb2bf>},</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">31</span><span>    <span style=color:#abb2bf>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">32</span><span>        <span style=color:#aa89ea>tag</span><span style=color:#54b1c7>:</span> <span style=color:#98c379>&#39;textNode&#39;</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">33</span><span>        <span style=color:#aa89ea>type</span><span style=color:#54b1c7>:</span> <span style=color:#d19a66>1</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">34</span><span>        <span style=color:#aa89ea>position</span><span style=color:#54b1c7>:</span> <span style=color:#d19a66>3</span><span style=color:#abb2bf>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">35</span><span>        <span style=color:#aa89ea>content</span><span style=color:#54b1c7>:</span> <span style=color:#98c379>&#39;Markdown&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">36</span><span>    <span style=color:#abb2bf>},</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">37</span><span><span style=color:#abb2bf>]</span>
</span></span></code></pre></div><h5 id=这部分的实现思路也比较简单基本上都是字符串处理>这部分的实现思路也比较简单，基本上都是字符串处理。</h5><ol><li><p><code>tag</code>：HTML标签的结构很简单，大致就以下几种：（最后一种不需要处理，可以忽略）</p><ol><li><code>&lt;tagName attrKey="attrValue" attrKey></code> <code>&lt;tagName attrKey="attrValue" attrKey ></code></li><li><code>&lt;tagName/></code> <code>&lt;tagName /></code></li><li><code>&lt;/tagName></code> （忽略）</li></ol><p>很容易发现要想得到tagName只需要找到在<code>&lt;</code>和（<code>空格</code>或<code>/</code>）之间的字符串就可以了。</p></li><li><p><code>type</code>：这个属性是为了方便之后的类型处理添加的，毕竟数字相对字符串来说更好处理。</p><p>我在配置文件里写了一个映射表（<a href=../src/lib/nwodkramConfig.js>配置文件</a>），以<code>tag</code>作为key对应数字作为value。这样就能很方便的对应起来。</p></li><li><p><code>position</code>：这个属性虽然叫<code>position</code>，其实<code>type</code>才更适合它，因为它标识了开始标签（Opening tag）：1，结束标签（Closing tag）：2，空元素（empty tag）和文本节点（text node）：3</p><p><code>position</code>的判断我写的比较简单，只考虑到了上文<code>tag</code>所列的几种情况（但也已经能包括大部分情况了）。从上面那几种情况来说。
只要判断<code>tag</code>开始位置的下标索引是/不是<code>1</code>，就能知道是/不是Opening tag了。</p><p>关于文本节点的判断：文本节点是没有<code>tag</code>的，如果无法搜索到<code>tag</code>，就可以将节点标识为文本节点。</p></li><li><p><code>attr</code>：<code>attr</code>里面保存着解析成Markdown文本所需要的一些属性。得益于Markdown语法的简洁，HTML标签大部分的属性都是可以忽略的。基本上只需要<code>src</code>，<code>title</code>，<code>alt</code>，<code>id</code>这几种，下面是相对应的语法：</p><ol><li>Markdown规范中的与链接有关的语法（<code>Links</code> <code>Images</code> <code>Heading IDs</code> <code>Footnotes</code>）。<ol><li><code>Links</code>：<code>src</code> <code>title</code></li><li><code>Image</code>: <code>src</code> <code>title</code> <code>alt</code></li><li><code>Heading IDs</code>：<code>id</code></li><li><code>Footnotes</code>：<code>id</code></li></ol></li></ol></li><li><p><code>content</code>：是文本节点独有的属性，表示文本节点的内容。</p></li></ol><p>具体实现见<a href=../src/lib/parser.js>parser.js</a></p><h2 id=结束>结束</h2><p>反向解析要详细讲比较繁琐，这是第一部分，预计分三章讲完。</p></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/%E7%A0%94%E7%A9%B6>研究</a></li><li><a href=/tags/markdown>Markdown</a></li><li><a href=/tags/markdown%E8%A7%A3%E6%9E%90>Markdown解析</a></li></ul></nav></div></article></main><footer><div style=display:flex><a class=soc href=https://github.com/siaikin rel=me title=Github><i data-feather=github></i></a>
<a class=border></a><a class=soc href=abc1310054026@outlook.com rel=me title=Email><i data-feather=mail></i></a>
<a class=border></a><a class=soc href=/index.xml rel=me title=RSS><i data-feather=rss></i></a>
<a class=border></a></div><div class=footer-info>2023 <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a></div></footer><script>feather.replace()</script></div></body></html>