<!doctype html><html><head lang=zh-cn><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Angular2+ 自定义Tree组件(参考Angular-material的CdkTree) - siaikin's Blog</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="为了方便, 本文所有的Angular均表示Angula2及以上版本，对于使用Angular1/Angular.js的读者可作为参考 前言 目前正在"><meta property="og:image" content><meta property="og:title" content="Angular2+ 自定义Tree组件(参考Angular-material的CdkTree)"><meta property="og:description" content="为了方便, 本文所有的Angular均表示Angula2及以上版本，对于使用Angular1/Angular.js的读者可作为参考 前言 目前正在"><meta property="og:type" content="article"><meta property="og:url" content="https://siaikin.github.io/posts/angular2-%E8%87%AA%E5%AE%9A%E4%B9%89tree%E7%BB%84%E4%BB%B6-%E5%8F%82%E8%80%83angular-material%E7%9A%84cdktree/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-06-02T21:44:52+00:00"><meta property="article:modified_time" content="2019-06-02T21:44:52+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Angular2+ 自定义Tree组件(参考Angular-material的CdkTree)"><meta name=twitter:description content="为了方便, 本文所有的Angular均表示Angula2及以上版本，对于使用Angular1/Angular.js的读者可作为参考 前言 目前正在"><script src=https://siaikin.github.io/js/feather.min.js></script>
<link href=https://siaikin.github.io/css/fonts.11a1877508139eac0b5b4852ceb110c35641b3533321e66e39149e901ed5756b.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://siaikin.github.io/css/main.d902908ac6e0fab67957de5db5aea1b6455b19ae2ca98eac4c95a4a0fdc02238.css><link id=darkModeStyle rel=stylesheet type=text/css href=https://siaikin.github.io/css/dark.c95c5dcf5f32f8b67bd36f7dab66680e068fce2b303087294114aabf7a7c080b.css disabled></head><body><div class=content><header><div class=main><a href=https://siaikin.github.io/>siaikin's Blog</a></div><nav><a href=/>Home</a>
<a href=/posts>All posts</a>
<a href=/about>About</a>
<a href=/tags>Tags</a>
| <span id=dark-mode-toggle onclick=toggleTheme()></span>
<script src=https://siaikin.github.io/js/themetoggle.js></script></nav></header><main><article><div class=title><h1 class=title>Angular2+ 自定义Tree组件(参考Angular-material的CdkTree)</h1><div class=meta>Posted on Jun 2, 2019</div></div><section class=body><p><strong>为了方便, 本文所有的<code>Angular</code>均表示Angula2及以上版本，对于使用<code>Angular1</code>/<code>Angular.js</code>的读者可作为参考</strong></p><h2 id=前言>前言</h2><p>目前正在写一个<code>Angular</code>的<code>Markdown</code>编辑器，需要一个树形组件来写文件系统。刚好之前用过<code>Angular Material</code>的<a href=https://material.angular.cn/cdk/tree/overview>树形组件</a>，就想照着写一个。毕竟直接把<code>Angular Material</code>引进来会多出其他用不到的组件，而且自己实现还能更深入学习<code>Angular</code>。</p><h2 id=介绍>介绍</h2><p>在写之前我百度了一通，发现大部分文章的Tree组件实现都是把节点模板直接写在了组件里，类似下面</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1</span><span><span style=color:#8a93a5;font-style:italic>&lt;!--Tree组件--&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2</span><span><span style=color:#abb2bf>&lt;</span><span style=color:#76a9f9>tree</span><span style=color:#abb2bf>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3</span><span>    <span style=color:#abb2bf>&lt;</span><span style=color:#76a9f9>tree-node</span><span style=color:#abb2bf>&gt;&lt;/</span><span style=color:#76a9f9>tree-node</span><span style=color:#abb2bf>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4</span><span><span style=color:#abb2bf>&lt;/</span><span style=color:#76a9f9>tree</span><span style=color:#abb2bf>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5</span><span><span style=color:#8a93a5;font-style:italic>&lt;!--TreeNode组件--&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6</span><span><span style=color:#abb2bf>&lt;</span><span style=color:#76a9f9>tree-node</span><span style=color:#abb2bf>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7</span><span>    <span style=color:#8a93a5;font-style:italic>&lt;!--本节点内容--&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8</span><span>    {{ nodeName }}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9</span><span>    <span style=color:#8a93a5;font-style:italic>&lt;!--子节点--&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10</span><span>    <span style=color:#abb2bf>&lt;</span><span style=color:#76a9f9>tree-node</span> *<span style=color:#cebc3a>ngIf</span><span style=color:#54b1c7>=</span><span style=color:#98c379>&#34;hasChildren&#34;</span><span style=color:#abb2bf>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">11</span><span>    <span style=color:#abb2bf>&lt;/</span><span style=color:#76a9f9>tree-node</span><span style=color:#abb2bf>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">12</span><span><span style=color:#abb2bf>&lt;</span><span style=color:#76a9f9>tree-node</span><span style=color:#abb2bf>&gt;</span>
</span></span></code></pre></div><p>说明一下: <code>Tree</code>组件里面包含<code>TreeNode</code>组件，<code>TreeNode</code>组件内部实现了递归子节点的逻辑。<br>其实这样的结构已经足够满足我的需求了，但是（因为强迫症）这样的可重用性几乎是没有，因为节点的内容已经写死在<code>TreeNode</code>组件里了。<br>然后我想到了<code>Angular Material</code>的<code>CdkTree</code>。他的结构如下</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">1</span><span><span style=color:#abb2bf>&lt;</span><span style=color:#76a9f9>tree</span> <span style=color:#cebc3a>dataSource</span><span style=color:#54b1c7>=</span><span style=color:#98c379>&#34;ds&#34;</span><span style=color:#abb2bf>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">2</span><span>    <span style=color:#abb2bf>&lt;</span><span style=color:#76a9f9>tree-node</span><span style=color:#abb2bf>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">3</span><span>        <span style=color:#8a93a5;font-style:italic>&lt;!--本节点内容--&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">4</span><span>        {{ nodeName }}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">5</span><span>        <span style=color:#8a93a5;font-style:italic>&lt;!--子节点出口--&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">6</span><span>        <span style=color:#abb2bf>&lt;</span><span style=color:#76a9f9>outlet</span><span style=color:#abb2bf>&gt;&lt;/</span><span style=color:#76a9f9>outlet</span><span style=color:#abb2bf>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">7</span><span>    <span style=color:#abb2bf>&lt;/</span><span style=color:#76a9f9>tree-node</span><span style=color:#abb2bf>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">8</span><span><span style=color:#abb2bf>&lt;/</span><span style=color:#76a9f9>tree</span><span style=color:#abb2bf>&gt;</span>
</span></span></code></pre></div><p>说明: 简单的说就是<code>CdkTree</code>把<code>&lt;tree-node></code>里的内容作为一个模板保存起来，然后根据数据源递归渲染出来。这样我们就可以在不修改<code>Tree</code>和<code>TreeNode</code>组件前提下改变其内容。</p><h2 id=实现>实现</h2><p>在实现之前需要理解<code>Angular</code>的几个装饰器，学过<code>Angular</code>的应该都不会陌生。</p><ul><li><code>@ViewChild</code> - 在视图中查询匹配的第一个元素</li><li><code>@ViewChildren</code> - 在视图中查询匹配的所有元素</li><li><code>@ContentChild</code> - 在组件标签包裹的内容中查询匹配的第一个元素</li><li><code>@ContentChildren</code> - 在组件标签包裹的内容中查询匹配的所有元素</li></ul><p><strong>View和Content的区别</strong><br>View: 在组件的模板中定义的内容，即我们手动写在xxx.component.html里的内容
Content: 在<code>Host</code>元素的<code>&lt;opening></code>和<code>&lt;closeing></code>标签中的内容</p><h2 id=概览>概览</h2><p>在Tree组件中有四个比较重要的类</p><ul><li><code>@Component: TreeComponent</code></li><li><code>@Component: TreeNodeComponent</code></li><li><code>@Directive: TreeNodeOutletDirective</code></li><li><code>@Directive: TreeNodeDefDirective</code></li></ul><h3 id=treecomponent>TreeComponent</h3><p>该组件就是我们要是实现的<code>Tree</code>组件，用于包裹<code>TreeNode</code></p><h3 id=treenodecomponent>TreeNodeComponent</h3><p>树节点组件，我们自定义的模板就写在这里面</p><h3 id=treenodeoutletdirective>TreeNodeOutletDirective</h3><p>这个指令设置了子节点的出口位置</p><h3 id=treenodedefdirective>TreeNodeDefDirective</h3><p>这个指令用来定义树节点所需的数据，即我们使用这个指令让模板可以使用每个树节点对应的数据</p><h2 id=实现-1>实现</h2><p>我们先看一下完成后的样子</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 1</span><span><span style=color:#abb2bf>&lt;</span><span style=color:#76a9f9>nb-tree</span> [<span style=color:#cebc3a>dataSource</span>]=&#34;<span style=color:#cebc3a>fileTree</span>&#34;<span style=color:#abb2bf>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 2</span><span>    <span style=color:#abb2bf>&lt;</span><span style=color:#76a9f9>nb-tree-node</span> *<span style=color:#cebc3a>nbTreeNodeDef</span><span style=color:#54b1c7>=</span><span style=color:#98c379>&#34;let data = data&#34;</span><span style=color:#abb2bf>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 3</span><span>        <span style=color:#abb2bf>&lt;</span><span style=color:#76a9f9>li</span><span style=color:#abb2bf>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 4</span><span>          <span style=color:#abb2bf>&lt;</span><span style=color:#76a9f9>span</span><span style=color:#abb2bf>&gt;</span>{{ data.title }}<span style=color:#abb2bf>&lt;/</span><span style=color:#76a9f9>span</span><span style=color:#abb2bf>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 5</span><span>        <span style=color:#abb2bf>&lt;/</span><span style=color:#76a9f9>li</span><span style=color:#abb2bf>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 6</span><span>        <span style=color:#abb2bf>&lt;</span><span style=color:#76a9f9>ul</span><span style=color:#abb2bf>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 7</span><span>          <span style=color:#abb2bf>&lt;</span><span style=color:#76a9f9>ng-container</span> <span style=color:#cebc3a>nbTreeNodeOutlet</span><span style=color:#abb2bf>&gt;&lt;/</span><span style=color:#76a9f9>ng-container</span><span style=color:#abb2bf>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 8</span><span>        <span style=color:#abb2bf>&lt;/</span><span style=color:#76a9f9>ul</span><span style=color:#abb2bf>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f"> 9</span><span>    <span style=color:#abb2bf>&lt;/</span><span style=color:#76a9f9>nb-tree-node</span><span style=color:#abb2bf>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#58626f">10</span><span><span style=color:#abb2bf>&lt;/</span><span style=color:#76a9f9>nb-tree</span><span style=color:#abb2bf>&gt;</span>
</span></span></code></pre></div><p>（标签前面的nb请忽略，这只是默认的前缀）上面是完成后的简易版。
我们可以看到在<code>tree</code>组件上设置了<code>dataSource</code>。</p><p>然后在<code>treeNodeDef</code>指令中我们导出了数据对象<code>data</code>。然后在模板中使用了它<code>&lt;span>{{ data.title }}&lt;/span></code>。</p><p>最后我们在<code>&lt;ng-container></code>上用<code>treeNodeOutlet</code>指令设置了子节点的出口。
懒得详细写实习了。。。有空再写吧。本文主要提供一个通用树形组件的思路。</p><p>想看代码的，看结尾。有一个不是很完善的<code>tree</code>组件，我用在正在写的Markdown编辑器上了。</p><h2 id=结尾>结尾</h2><p>Github: <a href=https://github.com/abc1310054026/ngr2-markdown/tree/master/projects/ngr2-markdown/src/lib/tree><code>tree</code>组件链接</a></p></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/%E7%A0%94%E7%A9%B6>研究</a></li><li><a href=/tags/angular2>Angular2</a></li><li><a href=/tags/tree>Tree</a></li></ul></nav></div></article></main><footer><div style=display:flex><a class=soc href=https://github.com/siaikin rel=me title=Github><i data-feather=github></i></a>
<a class=border></a><a class=soc href=abc1310054026@outlook.com rel=me title=Email><i data-feather=mail></i></a>
<a class=border></a><a class=soc href=/index.xml rel=me title=RSS><i data-feather=rss></i></a>
<a class=border></a></div><div class=footer-info>2023 <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a></div></footer><script>feather.replace()</script></div></body></html>